<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">
    <link href="https://fonts.googleapis.com/css?family=Istok+Web&display=swap" rel="stylesheet" />
    <link href="./css/main.css" rel="stylesheet" />
    <title>E-waste Management</title>
    <link rel="stylesheet" type="text/css"
        href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps.css" />
    <link rel="shortcut icon" href="#">
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps-web.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        const redMarker = new tt.Marker({ color: 'red' }); // Create a red marker
    </script>
    <style>
        #creditTable {
            margin-top: 20px;
            display: none;
            border: 1px solid #000;
        }

        table {
            width: 100%;
            border-collapse: collapse;

        }

        th,
        td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #000;
        }

        .hidden {
            display: none;
        }
    </style>

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner"
        class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->


    <!-- Navbar & Hero Start -->
    <div class="container-fluid position-relative p-0">
        <nav class="navbar navbar-expand-lg navbar-light px-4 px-lg-5 py-3 py-lg-0">
            <a href="" class="navbar-brand p-0">
                <h1 class="text-primary m-0" ><img src="./img/Logo.png" alt="Logo" style="height: 100px; border-radius: 50%;"></i>E-संग्रहण</h1>
                
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="fa fa-bars"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto py-0">
                    <a href="index.html" class="nav-item nav-link active">Home</a>
                    <a href="" class="nav-item nav-link">Locate</a>
                    <a href="" class="nav-item nav-link">Credits</a>
                    <a href="" class="nav-item nav-link">About Us</a>
                    <!-- <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                        <div class="dropdown-menu m-0">
                            <a href="destination.html" class="dropdown-item">Destination</a>
                            <a href="booking.html" class="dropdown-item">Booking</a>
                            <a href="team.html" class="dropdown-item">Travel Guides</a>
                            <a href="testimonial.html" class="dropdown-item">Testimonial</a>
                            <a href="404.html" class="dropdown-item">404 Page</a>
                        </div>
                    </div> -->
                    <a href="" class="nav-item nav-link">Articles</a>
                </div>
                <!-- <a href="" class="btn btn-primary rounded-pill py-2 px-4">Register</a> -->
            </div>
        </nav>

        <div class="container-fluid bg-primary py-5 mb-5 hero-header">
            <div class="container py-5">
                <div class="row justify-content-center py-5">
                    <div class="col-lg-12 pt-lg-5 mt-lg-5 text-center">
                        <h1 class="display-3 text-white mb-3 animated slideInDown">Let's manage your e-waste</h1>
                        <p class="fs-4 text-white mb-4 animated slideInDown">Find nearest e-waste facilities near you
                        </p>
                        <!-- <div class="position-relative w-75 mx-auto animated slideInDown">
                            <input class="form-control border-0 rounded-pill w-100 py-3 ps-4 pe-5" type="text"
                                placeholder="Enter your location city" id="location-input">
                            <button type="button" onclick="submitForm()"
                                class="btn btn-primary rounded-pill py-2 px-4 position-absolute top-0 end-0 me-2"
                                style="margin-top: 7px;">Search</button>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Navbar & Hero End -->
    <div class="mx-auto position-relative w-190 animated slideInDown" style="align-items: center;">
        <div style="display: flex;  width: 900px;">
            <input class="form-control" type="text"
                placeholder="Enter your location city" id="location-input"
                style="flex-grow: 1; height: 50px; margin-left: 550px; ">
            <button type="button" onclick="submitForm()"
                class="btn btn-primary rounded-pill py-2 px-4"
                style="margin-left: 10px;">Search
            </button>
        </div>
    </div>

    <!-- About Start -->
    <div class="container-xxl py-5">
        <div class="container">
            <div class="row g-5">
                <div class="col-lg-6 wow fadeInUp" data-wow-delay="0.1s" style="min-height: 400px;">
                    <div class="position-relative h-100">
                    
                        
                        <div id="map" style="width: 1300px; height: 600px;"></div>
                    </div>
                </div>
                <script type="text/javascript">
                    var map = tt.map({
                        key: "gdDQALLPzOIVyP5gTdrqyBkXJCPfhRu4",
                        container: "map",
                        center: center,
                        zoom: 10
                    })

                    // Check if geolocation is available in the browser
                    if ("geolocation" in navigator) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var userLat = position.coords.latitude;
                            var userLng = position.coords.longitude;

                            map.setCenter([userLng, userLat]);

                            // Add a marker at the user's location
                            redMarker
                                .setLngLat([userLng, userLat])
                                .setPopup(new tt.Popup().setHTML(`<p>Latitude: ${userLat}<br>Longitude: ${userLng}</p>`))
                                .addTo(map);
                        });
                    } else {
                        alert("Enable location permission!!!");
                        console.error("Geolocation is not available in this browser.");
                    }

                    // Function to add markers for all locations in the Excel file
                    function addMarkersForLocations(data) {
                        data.forEach((location) => {
                            new tt.Marker()
                                .setLngLat([location.longitude, location.latitude])
                                .setPopup(new tt.Popup().setHTML(`<p><h4>${location.name}</h4>${location.email}<br>${location.contact}</p></p>`))
                                .addTo(map);
                        });
                    }

                    // Fetch and parse the Excel file
                    fetch('location.xlsx')
                        .then((response) => response.arrayBuffer())
                        .then((arrayBuffer) => {
                            const data = new Uint8Array(arrayBuffer);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const sheetName = workbook.SheetNames[0];
                            const sheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(sheet);
                            addMarkersForLocations(jsonData);
                        })
                        .catch((error) => {
                            console.error('Error fetching or parsing Excel file:', error);
                        });
                </script>
                <script>

                    function submitForm() {
                        const location = locationInput.value;

                        // Create the API request URL
                        const apiUrl = `https://api.tomtom.com/search/2/geocode/${encodeURIComponent(location)}.json?key=${apiKey}`;

                        // Make a GET request to TomTom API
                        axios.get(apiUrl)
                            .then(response => {
                                const coordinates = response.data.results[0].position;
                                const lat = coordinates.lat;
                                const lng = coordinates.lon;

                                console.log(`Latitude: ${lat}`);
                                console.log(`Longitude: ${lng}`);

                                // Update the map center to the user-entered coordinates
                                map.setCenter([lng, lat]);

                                // Add a marker at the user-entered location
                                redMarker
                                    .setLngLat([lng, lat])
                                    .setPopup(new tt.Popup().setHTML(`<p>Latitude: ${lat}<br>Longitude: ${lng}</p>`))
                                    .addTo(map);
                            })
                            .catch(error => {
                                console.error('Error fetching data:', error);
                            });
                    }

                    const locationInput = document.getElementById('location-input');
                    let center = [4, 44.4]; // Default map center

                    // Replace 'YOUR_API_KEY' with your actual TomTom API Key
                    const apiKey = 'gdDQALLPzOIVyP5gTdrqyBkXJCPfhRu4'; // Replace with your API key

                    var map = tt.map({
                        key: apiKey,
                        container: "map",
                        center: center,
                        zoom: 10
                    });

                </script>
                <script type="text/javascript">
                    var map = tt.map({
                        key: "gdDQALLPzOIVyP5gTdrqyBkXJCPfhRu4",
                        container: "map",
                        center: center,
                        zoom: 10
                    })

                    // Check if geolocation is available in the browser
                    if ("geolocation" in navigator) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var userLat = position.coords.latitude;
                            var userLng = position.coords.longitude;

                            map.setCenter([userLng, userLat]);

                            // Add a marker at the user's location
                            redMarker
                                .setLngLat([userLng, userLat])
                                .setPopup(new tt.Popup().setHTML(`<p>Latitude: ${userLat}<br>Longitude: ${userLng}</p>`))
                                .addTo(map);
                        });
                    } else {
                        alert("Enable location permission!!!");
                        console.error("Geolocation is not available in this browser.");
                    }

                    // Function to add markers for all locations in the Excel file
                    function addMarkersForLocations(data) {
                        data.forEach((location) => {
                            new tt.Marker()
                                .setLngLat([location.longitude, location.latitude])
                                .setPopup(new tt.Popup().setHTML(`<p><h4>${location.name}</h4>${location.email}<br>${location.contact}</p></p>`))
                                .addTo(map);
                        });
                    }

                    // Fetch and parse the Excel file
                    fetch('location.xlsx')
                        .then((response) => response.arrayBuffer())
                        .then((arrayBuffer) => {
                            const data = new Uint8Array(arrayBuffer);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const sheetName = workbook.SheetNames[0];
                            const sheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(sheet);
                            addMarkersForLocations(jsonData);
                        })
                        .catch((error) => {
                            console.error('Error fetching or parsing Excel file:', error);
                        });
                </script>
                
            </div>
        </div>
    </div>
    <!-- About End -->